<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>E. coli core minspans</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="visbio-dev0.4.0.js"></script>
    <meta charset="utf-8" />
    <style>
     .download { 
       position: absolute;
       left: 20px;
       top: 20px;
     }
    </style>

  </head>
  <body>
    <script type="text/javascript">
     d3.json('minspan_data_dict.json', load);

     function load(error, minspans) {
       if (error) return console.warn(error);

       var minspan_fluxes = {};

       var current_flux = {};
       var map = visbio.metabolic_map({ map_path: "core-e-coli-v3.json", 
				       fill_screen: true,
				       css_path: "metabolic-map.css",
				       flux_source: function(callback) {
	   console.log(current_flux); callback([current_flux], true);} });
       map.set_update_hook(function(sel) {
	 window.sel = sel;
	 sel.selectAll('.reaction-path')
	    .on('mouseover', function(d) {
	   /* var flux = {}, levels = [0, 20, 40, 60, 80, 100], count = 0;
	   for (var num in minspans) {
	   if (d.id in minspans[num]) { //(minspans[num].indexOf(d.id) > -1) {
	   minspans[num].map(function(reaction) {
	   flux[reaction] = levels[count];
	   });
	   count++;
	   }
	   console.log(d.id);
	   current_flux = [flux]; */
	   current_flux = minspans[d.id];
	   map.reload_flux();
	   /* } */
	 });
       });

       var ex = visbio.export_svg();
       d3.select('body').append('button')
	 .classed('download', true)
	 .text('download')
	 .on('click', function(d) { ex.download('map', 'svg', true); });
     }
    </script>
  </body>
</html>
